steps:
- name: 'gcr.io/cloud-builders/docker'
  args:
    # tag with BUILD_ID (or 'latest' if empty)
    - build
    - -t
    - 'gcr.io/$PROJECT_ID/product-sync:${BUILD_ID:-latest}'
    - '.'
- name: 'gcr.io/cloud-builders/docker'
  args:
    - push
    - 'gcr.io/$PROJECT_ID/product-sync:${BUILD_ID:-latest}'
- name: 'gcr.io/google.com/cloudsdktool/cloud-sdk'
  entrypoint: 'gcloud'
  args:
    - run
    - deploy
    - product-sync
    - --image=gcr.io/$PROJECT_ID/product-sync:${BUILD_ID:-latest}
    - --region=us-central1
    - --platform=managed
